---
title: "Livrable 1 - Nosferatu"
author: "Hong Phuoc DINH, Daria AVDEEVA"
date: "2025-04-26"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Dans ce projet, nous allons explorer et analyser un dataset contenant des informations sur les joueurs de Premier League.
L'objectif principal est de mieux comprendre les performances individuelles et collectives à travers différentes dimensions statistiques.
Pour cela, nous allons formuler plusieurs questions d’analyse qui nous guideront tout au long de l’exploration.
Les questions sont:\
1.
Les joueurs de certaines nationalités marquent-ils plus que d’autres ?\
2.
Quel est l'impact de l'âge sur les performances des joueurs ?\
3.
Quelles sont les différences de moyenne de buts marqués selon la position ?\
4.
Quels sont les joueurs les plus efficaces pour marquer des buts ?

```{r cars}
library(ggplot2)
library(dplyr)
library(fmsb)
data<-read.csv("data/premier_league_dataset.csv")
```

## Question 1: Les joueurs de certaines nationalités marquent-ils plus que d’autres ?

### Top 10 Joueurs avec leurs nationalité

```{r}
top_joueurs <- data %>% arrange(desc(Goals)) %>% slice_head(n = 10) 
top_joueurs <- top_joueurs %>%
  mutate(label = paste(Name, "(", Nationality, ")", sep = ""))

ggplot(top_joueurs, aes(x = reorder(label, Goals), y = Goals)) +
  geom_col(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Top 10 des meilleurs buteurs",
       x = "Joueur (Nationalité)",
       y = "Nombre de buts")+coord_flip()
```

D'abord, nous avons analysé les 10 meilleurs buteurs de la Premier League.
On remarque que, mis à part le meilleur buteur, qui est Argentin, la majorité des joueurs présents dans ce top 10 sont Européens, notamment beaucoup d’Anglais.
Un seul joueur africain figure parmi eux : Mohamed Salah, de nationalité égyptienne.

### Moyenne des buts par nationalité (Top 10 pays)

```{r}
top_nation <- data %>% group_by(Nationality) %>% filter(n() >= 10) %>% summarise(avg_goals=mean(Goals,na.rm = TRUE)) %>% arrange(desc(avg_goals)) %>% slice_head(n = 10) 

ggplot(top_nation,aes(x = Nationality, y = avg_goals))+geom_bar(stat="identity",fill = "skyblue", color = "darkblue") +theme_minimal() +
  labs(title = "Moyenne des buts par nationalité (Top 10 pays)",
       x = "Nationalité",
       y = "Moyenne de buts") 
```

On observe alors que l'Argentine affiche la meilleure moyenne, suivie de la Belgique, du Brésil, puis de la France, etc.
Ainsi, l’Amérique du Sud occupe la première et la troisième place, tandis que les autres nationalités du top 10 sont principalement européennes et anglais.Cette forte présence sud-américaine (Argentine, Brésil) peut s'expliquer par la culture football très forte dans ces pays, où le football est souvent considéré comme une véritable passion nationale, produisant de nombreux joueurs talentueux dès le plus jeune âge.

### Distribution des buts par nationalité (Top 10 pays)

```{r}
top_nation_data <-data %>%
  filter(Nationality %in% top_nation$Nationality)

ggplot(top_nation_data, aes(x = Nationality, y = Goals)) +
theme_minimal() +  
  geom_boxplot(fill = "skyblue", color = "darkblue") +
  labs(title = "Distribution des buts par nationalité (Top 10 pays)",
       x = "Nationalité",
       y = "Nombre de buts")

```

Pour aller plus loin, nous avons observé la distribution du nombre de buts par nationalité à l’aide de boîtes à moustaches (boxplots).

On remarque que l'Argentine n’est pas systématiquement performante : c’est principalement grâce à un seul joueur, Aguero, dont le nombre de buts exceptionnel fait fortement augmenter la moyenne.
En revanche, les joueurs de Belgique, du Brésil, de France, d’Irlande et d’Écosse présentent des distributions assez semblables.

Concernant les Anglais, leur moyenne est relativement basse, mais on observe beaucoup d'outliers positifs : cela suggère qu’il existe à la fois de très bons joueurs (qui marquent beaucoup) et de nombreux joueurs moyens ou faibles, ce qui fait baisser la moyenne globale.Cela s'explique en partie par le fait que la Premier League est un championnat anglais, avec naturellement un plus grand nombre de joueurs anglais, donc plus de chances d'avoir à la fois des stars et des joueurs moins performants.

### Conclusion

Notre analyse montre que oui, certaines nationalités marquent plus que d'autres en Premier League.
Les Sud-Américains, notamment les Argentins et les Brésiliens, dominent grâce à une culture du football profondément ancrée, où la formation technique et la passion pour ce sport sont omniprésentes dès l'enfance.
À leurs côtés, plusieurs nationalités européennes comme la Belgique ou la France affichent également de très bonnes performances, en lien avec des systèmes de formation rigoureux et compétitifs.
Les joueurs anglais, bien qu'en surnombre, présentent une forte hétérogénéité : si certains comptent parmi les meilleurs buteurs, d'autres, moins performants, tirent la moyenne nationale vers le bas, reflet du fait que la Premier League offre davantage d'opportunités aux joueurs locaux, quel que soit leur niveau.
Ainsi, si la nationalité influence clairement la capacité à marquer, elle interagit aussi avec d’autres facteurs essentiels comme la formation, la sélection sportive et l’accès au championnat.

## Question 2: Quel est l'impact de l'âge sur les performances des joueurs ?

```{r}
summary(data)
```

### Préparation et analyse des données

Lorsqu'on regarde l'état du dataset, on constate qu'il y a une donnée manquante dans la feature "Age", qu'il faut donc supprimer.

```{r}
df <- data %>% 
  filter(!is.na(Age))

#On vérifie que la suppression a bien été prise en compte
summary(df)
```

Intéressons nous au différentes positions des joueurs.

```{r}
unique(df$Position)
```

Pour chaque feature, on étudiera la performance de manière différente.
En effet, ça n'a pas de sens de s'intéresser au nombre de buts marqués pour un Defender par exemple.

Pour le **Goalkeeper**, on va s'intéresser à la feature *Saves*, car elle mesure sa capacité à arrêter les tirs adverses, ce qui est essentiel pour juger la performance d'un gardien

Pour le **Defender**, on va s'intéresser à la feature *Interceptions*, car elle mesure sa capacité à couper les passes adverses, ce qui permet de limiter les occasions de but et sécuriser la défense.

Pour le **Midfielder**, on va s'intéresser à la feature *Assists*, car elle reflète sa capacité à créer des occasions décisives dans le match

Pour le **Forward**, on va s'intéresser à la feature *Goals*, car c'est l'indicateur principal de son efficacité offensive, marquer des buts étant sa contribution principale attendue pour faire gagner son équipe.

```{r}

df <- df %>%
  mutate(
    # Calcul de la Performance
    Performance = case_when(
      Position == "Goalkeeper" & !is.na(Saves) ~ Saves,
      Position == "Defender" & !is.na(Interceptions) ~ Interceptions,
      Position == "Midfielder" & !is.na(Assists) ~ Assists,
      Position == "Forward" & !is.na(Goals) ~ Goals,
      TRUE ~ NA_real_ #met une valeur manquante si les conditions ne sont pas remplies
    ),
    
    # Définition de la classe de la performance (feature associée)
    Performance.class = case_when(
      Position == "Goalkeeper" & !is.na(Saves) ~ "Saves",
      Position == "Defender" & !is.na(Interceptions) ~ "Interceptions",
      Position == "Midfielder" & !is.na(Assists) ~ "Assists",
      Position == "Forward" & !is.na(Goals) ~ "Goals",
      TRUE ~ NA_character_ #met une valeur manquante si les conditions ne sont pas remplies
    )
  )

 
```

```{r}
unique(df$Performance.class)
```

### Visualisation

```{r}
ggplot(df, aes(x = Age, y = Performance, color = Performance.class)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "loess", color = "red") +
  facet_wrap(~Position, scales = "free_y") +
  labs(title = "Performance des joueurs de Premiere League en fonction de l'âge et par position",
       x = "Âge",
       y = "Performance",
       color = "Performance") +
  
  #Esthétique
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 12),
    plot.subtitle = element_text(hjust = 0.5, size = 11),
    strip.text = element_text(face = "bold", size = 10),
    axis.text = element_text(size = 10),
    legend.position = "bottom"
    )

```

Dans le cas des **défendants**, on constate que les performances augmentent notamment après 27 ans.
On peut cependant remarquer une forte dispersion à partir de 33 ans.

Dans le cas des **attaquants**, la progression du nombre de buts marqués augmente également avec l'âge.
Cependant, cette augmentation est plus lente et progressive que celle des défendants.

Dans le cas des **gardiens**, la progression monte jusqu'aux environs de 33 - 34 ans, puis baisse.
On peut donc estimer que le gardien aurait la meilleure performance à 33 - 34 ans.
Néanmoins, les performances sont très dispersées d'un gardien à un autre.

Dans le cas des **joueurs du milieu**, la performance est assez faible et stagnante jusqu'aux environs de 30 ans, puis il y a une augmentation assez remarquable.

En général, les performances augmentent généralement avec l’âge, mais de manière plus rapide chez les défenseurs que dans les autres positions.
Par contre, les gardiens ont une carrière relativement plus longue, avec un pic de performance plus tardif.
Enfin, pour toutes les positions, on remarque une dispersion assez importante : il y a de jeunes joueurs très performants et de plus âgés peu performants dans chaque poste.

## Question 3:Quelles sont les différences de moyenne de buts marqués selon la position ?

```{r}
df_clean <- df %>%
  filter(!is.na(Position), !is.na(Goals)) %>%
  mutate(Position = case_when(
    grepl("Goalkeeper", Position, ignore.case = TRUE) ~ "Goalkeeper",
    grepl("Defender", Position, ignore.case = TRUE) ~ "Defender",
    grepl("Midfielder", Position, ignore.case = TRUE) ~ "Midfielder",
    grepl("Forward", Position, ignore.case = TRUE) ~ "Forward",
    TRUE ~ "Other"
  )) %>%
  filter(Position %in% c("Goalkeeper", "Defender", "Midfielder", "Forward"))  

position_stats <- df_clean %>%
  group_by(Position) %>%
  summarise(
    mean_goals = mean(Goals, na.rm = TRUE),
    sd_goals = sd(Goals, na.rm = TRUE),
    count = n()
  )

print(position_stats)
```

```{r pressure, echo=FALSE}
ggplot(position_stats, aes(x = Position, y = mean_goals)) +
  geom_col(fill = "skyblue", color = "black") +
  #geom_errorbar(aes(ymin = mean_goals - sd_goals, ymax = mean_goals + sd_goals),
                #width = 0.2, color = "red", linewidth = 1) +
  labs(
    title = "Nombre moyen de buts marqués par les joueurs à différents postes",
    x = "position",
    y = "Moyenne des buts"
  ) +
  theme_minimal()

ggplot(df_clean, aes(x = Position, y = Goals)) +
  geom_boxplot(fill = "lightblue", color = "black", outlier.color = "red", outlier.shape = 16) +
  labs(
    title = "Répartition des buts marqués par des joueurs occupant différents postes (graphique en boîte)",
    x = "position",
    y = "nombre de buts marqués"
  ) +
  theme_minimal()

```

###Ceci peut être analysé à l'aide du diagramme à barres et du diagramme en boîte :

1.Dans l'ensemble, les attaquants et les milieux de terrain sont chargés de marquer des buts, tandis que les défenseurs et les gardiens de but sont chargés de défendre.

2.Les attaquants sont ceux qui marquent le plus de buts dans l'ensemble, mais leurs performances sont très variables, quelques rares grands buteurs tirant la moyenne générale vers le haut.

3.Les milieux de terrain ont une capacité moyenne à marquer des buts, mais certains d'entre eux sont très impressionnants sur le plan offensif.
Cela montre qu'il ne faut pas négliger la capacité des milieux de terrain à marquer des buts, et que certains d'entre eux ont une forte capacité à s'impliquer.

4.Les défenseurs ont marqué très peu de buts et la différence globale est faible, mais certains défenseurs ont tout de même marqué un peu plus sur coups de pied arrêtés.

5.Les gardiens de but ne marquent pratiquement pas de buts et sont extrêmement réguliers.

## Question 4: Quels sont les joueurs les plus efficaces pour marquer des buts ?

La question de savoir quels joueurs sont les plus efficaces pour marquer des buts est importante dans le football.
Elle n'est pas aussi facile à répondre qu'il n'y parait.
Ce qui définit un joueur bon en attaque, n'est pas forcément sa statique du nombre de but marqués
même si elle est importante.

Pour commencer l'analyse, on va tous d'abord regarder au niveau global, c'est-à-dire dans l'ensemble de la Premier League, quels sont les joueurs qui ont marqué le plus de buts.

```{r}
data <- read.csv("C:\\Users\\lathv\\Desktop\\dataset - premier-league.csv", header = TRUE, sep = ",")
```

On constate qu'il ya des joueurs qui ont joués peu de match ce qui peut rendre les statistiques moins fiables donc on va se limiter aux joueurs ayant plus de 15 apparitions.

```{r}
seuil_apparitions <- 15 

data_clean <- data %>%
  filter(!is.na(Goals), !is.na(Appearances), Appearances > seuil_apparitions, !is.na(Shooting.accuracy..)) %>%
  mutate(Goals_per_match = Goals / Appearances)  
```

### Les joueurs qui marquent le plus de but sur l'ensemble de la Premier League

L'objectif de se poser cette question, c'est d'avoir une idée de la performance des joueurs en termes de buts marqués.
On va donc se concentrer sur les joueurs qui ont marqué le plus de buts.

```{r}
# Sélectionner les 10 meilleurs buteurs
top_scorers <- data_clean %>%
  arrange(desc(Goals)) %>%
  slice(1:10)

top_scorer_plot <- ggplot(top_scorers, aes(x = reorder(Name, Goals), y = Goals)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +  # Met les barres horizontales
  labs(title = "Top 10 des buteurs - Premier League",
       x = "Joueur",
       y = "Nombre de buts")

top_scorer_plot
```

On constate que les meilleurs buteurs marquent au moins plus de 50 buts dans leurs carrière et peuvent marquer plus de 100 buts.

### Vérifier la distribution de nombre de buts par match

Cependant, connaître le nombre de but marqué au total par joueurs ne suffit pas.
Parce que certains joueurs ont joué plus de matchs que d'autres et donc le nombre de but marqué.
C'est pourquoi, on va se concentrer sur le nombre de buts marqué par match.

Le jeu de données possèdent des valeurs aberrantes dans la variable goals per match , que nous avons dû corrigé en la recalculant nous même.

```{r}
goals_distribution_corrected <- ggplot(data_clean, aes(x = Goals_per_match)) +
  geom_histogram(binwidth = 0.05, fill = "steelblue", color = "black", boundary = 0) +
  labs(title = "Distribution des nombres de buts par match",
       x = "Buts par match",
       y = "Nombre de joueurs") 
goals_distribution_corrected
```

L'idée est de se faire une idée de la distribution des buts par match et de savoir sur tous les joueurs y compris ceux qui n'ont pas marqué de but, combien de joueurs ont marqué.
On peut constaté qu'une minorité de joueurs ont marqué plus de 0.5 buts par match.

### Top 10 des joueurs ayant une moyenne de buts les plus élevées

On va maintenant se concentrer sur les joueurs qui ont marqué le plus de buts par match

```{r}
top_10_players <- data_clean %>%
  arrange(desc(Goals_per_match)) %>% 
  head(10) %>%
  select(Name, Goals, Goals_per_match)

bar_chart <- ggplot(top_10_players, aes(x = reorder(Name, Goals_per_match), y = Goals_per_match)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Top 10 des joueurs avec la meilleur moyenne de buts par match",
       x = "Joueur",
       y = "Buts par match") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

bar_chart
```

On constate que les meilleurs joueurs en termes de buts par match font au moins 0.4 buts par match.

### L'impact de la précision du tir sur les buts par matchs

Maintenant, on va se poser la question de savoir si au football et notamment dans la Premier League, la précision du tir a un impact sur le nombre de buts marqués par match.

```{r}

data_clean$`Shooting.accuracy..` <- as.numeric(gsub("%", "", data_clean$`Shooting.accuracy..`)) / 100

ggplot(data_clean, aes(x = Shooting.accuracy.., y = Goals_per_match)) +
  geom_point(color = "blue", size = 3, alpha = 0.7) + 
  geom_smooth(method = "lm", se = FALSE, color = "red", linetype = "dashed") +
  labs(title = "Précision des tirs vs moyenne de buts par match", x = "Précision des tirs (%)", y = "Buts par match") 
```

On constate qu'il y a une corrélation positive entre la précision des tirs et le nombre de buts marqués par match.
La précision des tirs est donc un facteur important pour marquer des buts.

### Comparaison du top 3 par rapports à la moyenne des joueurs de la Premier league

On va maintenant se concentrer sur les 3 meilleurs joueurs et la moyenne des joueurs de la Premier League.
L'objectif est de voir sur les 3 meilleurs joueurs qu'on peut considérer les plus efficaces devant les buts.
Il y'a-t-il un joueur qui se démarque des autres ou il y a-t-il une variable qui fait que certains joueurs marquent plus de buts que d'autres.

```{r}
library(dplyr)
library(fmsb)

# Sélectionner les 3 meilleurs joueurs
top3_scorers <- data_clean %>%
  arrange(desc(Goals)) %>%
  slice(1:3) %>%
  select(Name, Goals, Shots, Shooting.accuracy.., Assists,Duels.won,Passes)

# Calculer la moyenne
mean_players <- data_clean %>%
  summarise(Goals = mean(Goals, na.rm = TRUE),
            Shots = mean(Shots, na.rm = TRUE),
            Shooting.accuracy.. = mean(Shooting.accuracy.., na.rm = TRUE),
            Assists = mean(Assists, na.rm = TRUE,),
            Duels.won = mean(Duels.won, na.rm = TRUE),
            Passes = mean(Passes, na.rm = TRUE))

# Ajouter le nom "Moyenne" à la ligne de la moyenne
mean_players$Name <- "Moyenne"

combined <- bind_rows(top3_scorers, mean_players)

rownames(combined) <- combined$Name
combined <- combined %>% select(-Name)

# Normaliser toutes les données en utilisant les min et max des données complètes (data_clean)
normalize <- function(x, min_value, max_value) {
  (x - min_value) / (max_value - min_value)
}

combined_normalized <- as.data.frame(lapply(names(combined), function(col_name) {
  normalize(combined[[col_name]], min(data_clean[[col_name]], na.rm = TRUE), max(data_clean[[col_name]], na.rm = TRUE))
}))

colnames(combined_normalized) <- c("Buts", "Tir effectué", "Précision de tirs", "Assists","Duels gagnés","Passes")

final_data <- rbind(rep(1, ncol(combined_normalized)),   # Ligne max
                    rep(0, ncol(combined_normalized)),   # Ligne min
                    combined_normalized)                # Données des joueurs et de la moyenne

colors_border <- c("red", "blue", "green", "orange", "purple", "black")
colors_in <- adjustcolor(colors_border, alpha.f = 0.2)

radarchart(final_data,
           axistype = 1,
           pcol = colors_border,
           pfcol = colors_in,
           plwd = 2,
           plty = 1,
           cglcol = "grey", cglty = 1, axislabcol = "grey", caxislabels = seq(0,1,0.2), cglwd = 0.8,
           vlcex = 0.8,
           title = "Comparaison du top 3 buteurs de Premier League")

legend(x = "topright",
       legend = c(rownames(combined)),  # Ajouter Max et Min à la légende
       bty = "n", pch=20, col=colors_border, text.col = "black", cex=0.8, pt.cex=1.5)


```

On constate que par rapport à la moyenne des joueurs de la Premier League, les meilleurs buteurs se démarquent par leur précision de tirs et le nombre de tirs effectués.
Ce ne sont pas des joueurs qui ont beaucoup de passes ou qui gagnent beaucoup de duels.
Cependant, ils ont quand même un nombre d'assists supérieur à la moyenne des joueurs de la Premier League.
Ce qui montre qu'ils sont aussi de bon passeur permettant à leur équipe de marquer.
