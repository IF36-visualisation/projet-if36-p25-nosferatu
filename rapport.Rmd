---
title: "IF36 - Rapport de projet"
author: "Hong Phuoc DINH, Daria AVDEEVA, Ziyi HUANG, Victor LATH"
date: "2025-04-26"
output:
  pdf_document: default
  html_document: default
editor_options:
  markdown:
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Présentation des données

Les données utilisées proviennent du dataset intitulé “All Time Premier League Player”. Ce dataset représente les statistiques des joueurs de toutes les saisons de la Premier League. Ce dataset a été trouvé sur kaggle, dont l'auteur est Rishikesh Kanabar, mais il est constitué de données provenant de https://www.premierleague.com/ . Ces données sont intéressantes pour l'analyse des performances individuelles et collectives des joueurs participant à la Premier League. De plus, elles peuvent être utiles dans l'analyse sportive, puisqu'elles permettent de comparer les performances entre les différents joueurs et les différentes équipes, repérer des talents émergents et aider à une meilleure prise de décision pour les entraîneurs ainsi que les analystes sportifs.\

Le dataset est constitué de **571 joueurs et de 59 variables**. Parmi elles, on retrouve des:

- variables textuelles (ex: Name, Club, Nationality)
- variables continues (ex: Age, Goals, Shots)
- variables catégorielles (ex: Postion, qui ne prend que les valeurs “Forward”, “Goalkeeper”, “Defender”, “Midfielder”)

Le dataset est un fichier CSV, où chaque ligne représente un joueur et chaque colonne représente une variable. 

Voici un résumé du dataset:

```{r echo=FALSE}
data<-read.csv("data/premier_league_dataset.csv")
summary(data)
```
## Plan d'analyse

Afin de mieux comprendre et exploiter les données, nous avons élaboré le plan d’analyse suivant :

#### 1. Sélection des variables et nettoyage des données

- Identification des variables clés pour l’analyse (buts, passes, minutes jouées, âge, poste, club, etc.)
- Suppression des variables inutiles ou redondantes
- Création éventuelle de nouvelles variables pour faciliter l’interprétation (ex : ratio buts/minutes jouées)
- Vérification de la présence de valeurs manquantes ou aberrantes dans le dataset
- Vérification de l’uniformisation des formats (noms de pays, abréviations des clubs, variables catégorielles, etc.)
- Vérification et correction des types de données, en s’assurant que les champs numériques sont bien au format approprié

#### 2. Analyse statistique descriptive

- Description des variables à l’aide de statistiques de base (moyenne, médiane, écart-type, etc.)
- Visualisation de la distribution globale des données (histogrammes, diagrammes en boîte, etc.)

#### 3. Comparaison des performances selon les postes

- Analyse de la répartition de l’âge, du nombre de buts et de passes décisives par poste
- Comparaison des données offensives entre les attaquants, les milieux de terrain et les défenseurs

#### 4. Analyse par club et nationalité

Répartition des performances par club
- Quels clubs comptent les joueurs les plus performants ?
- Comparaison des clubs les plus représentés dans le dataset
- Analyse de la contribution des joueurs par club

Analyse des nationalités dominantes
- Quelles nationalités sont les plus présentes en Premier League ?
- Les joueurs de certaines nationalités performent-ils mieux que d’autres ?

#### 5. Analyse croisée et visualisation avancée

- Exploration des relations linéaires ou non linéaires entre plusieurs variables numériques
- Visualisation des corrélations pour mieux comprendre les liens entre les différentes dimensions des données

#### 6. Découverte de talents et prédictions (optionnel, selon pertinence)

- Identification de groupes de joueurs présentant des caractéristiques de performance similaires
- Identification des joueurs sous-cotés (Détection des joueurs ayant un rendement élevé mais peu médiatisés)
- Prédiction du nombre de buts, de passes décisives, ou d’autres indicateurs de performance
- Construction de modèles permettant d’identifier les joueurs les plus performants offensivement

#### 7. Conclusion et recommandations

- Résumé des principales observations
- Discussion des limites des données (biais possibles, données manquantes)
- Pistes d’amélioration pour une analyse plus approfondie


```{r cars, echo=FALSE}
library(ggplot2)
library(dplyr)
library(fmsb)
library(tidyr)
library(colorspace)
library(GGally)
data<-read.csv("data/premier_league_dataset.csv")
```

# Question 1: Les joueurs de certaines nationalités marquent-ils plus que d’autres ?

## Top 10 Joueurs avec leurs nationalité

```{r echo=FALSE}
top_joueurs <- data %>% arrange(desc(Goals)) %>% slice_head(n = 10) 
top_joueurs <- top_joueurs %>%
  mutate(label = paste(Name, "(", Nationality, ")", sep = ""))

ggplot(top_joueurs, aes(x = reorder(label, Goals), y = Goals)) +
  geom_col(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Top 10 des meilleurs buteurs",
       x = "Joueur (Nationalité)",
       y = "Nombre de buts")+coord_flip()
```

D'abord, nous avons analysé les 10 meilleurs buteurs de la Premier League.
On remarque que, mis à part le meilleur buteur, qui est Argentin, la majorité des joueurs présents dans ce top 10 sont Européens, notamment beaucoup d’Anglais.
Un seul joueur africain figure parmi eux : Mohamed Salah, de nationalité égyptienne.

## Moyenne des buts par nationalité (Top 10 pays)

```{r echo=FALSE}
top_nation <- data %>% group_by(Nationality) %>% filter(n() >= 10) %>% summarise(avg_goals=mean(Goals,na.rm = TRUE)) %>% arrange(desc(avg_goals)) %>% slice_head(n = 10) 

ggplot(top_nation,aes(x = Nationality, y = avg_goals))+geom_bar(stat="identity",fill = "skyblue", color = "darkblue") +theme_minimal() +
  labs(title = "Moyenne des buts par nationalité (Top 10 pays)",
       x = "Nationalité",
       y = "Moyenne de buts") 
```

On observe alors que l'Argentine affiche la meilleure moyenne, suivie de la Belgique, du Brésil, puis de la France, etc.
Ainsi, l’Amérique du Sud occupe la première et la troisième place, tandis que les autres nationalités du top 10 sont principalement européennes et anglais.Cette forte présence sud-américaine (Argentine, Brésil) peut s'expliquer par la culture football très forte dans ces pays, où le football est souvent considéré comme une véritable passion nationale, produisant de nombreux joueurs talentueux dès le plus jeune âge.

## Distribution des buts par nationalité (Top 10 pays)

```{r echo=FALSE}
top_nation_data <-data %>%
  filter(Nationality %in% top_nation$Nationality)

ggplot(top_nation_data, aes(x = Nationality, y = Goals)) +
theme_minimal() +  
  geom_boxplot(fill = "skyblue", color = "darkblue") +
  labs(title = "Distribution des buts par nationalité (Top 10 pays)",
       x = "Nationalité",
       y = "Nombre de buts")

```

Pour aller plus loin, nous avons observé la distribution du nombre de buts par nationalité à l’aide de boîtes à moustaches (boxplots).

On remarque que l'Argentine n’est pas systématiquement performante : c’est principalement grâce à un seul joueur, Aguero, dont le nombre de buts exceptionnel fait fortement augmenter la moyenne.
En revanche, les joueurs de Belgique, du Brésil, de France, d’Irlande et d’Écosse présentent des distributions assez semblables.

Concernant les Anglais, leur moyenne est relativement basse, mais on observe beaucoup d'outliers positifs : cela suggère qu’il existe à la fois de très bons joueurs (qui marquent beaucoup) et de nombreux joueurs moyens ou faibles, ce qui fait baisser la moyenne globale.Cela s'explique en partie par le fait que la Premier League est un championnat anglais, avec naturellement un plus grand nombre de joueurs anglais, donc plus de chances d'avoir à la fois des stars et des joueurs moins performants.

## Conclusion

Notre analyse montre que oui, certaines nationalités marquent plus que d'autres en Premier League.
Les Sud-Américains, notamment les Argentins et les Brésiliens, dominent grâce à une culture du football profondément ancrée, où la formation technique et la passion pour ce sport sont omniprésentes dès l'enfance.
À leurs côtés, plusieurs nationalités européennes comme la Belgique ou la France affichent également de très bonnes performances, en lien avec des systèmes de formation rigoureux et compétitifs.
Les joueurs anglais, bien qu'en surnombre, présentent une forte hétérogénéité : si certains comptent parmi les meilleurs buteurs, d'autres, moins performants, tirent la moyenne nationale vers le bas, reflet du fait que la Premier League offre davantage d'opportunités aux joueurs locaux, quel que soit leur niveau.
Ainsi, si la nationalité influence clairement la capacité à marquer, elle interagit aussi avec d’autres facteurs essentiels comme la formation, la sélection sportive et l’accès au championnat.

# Question 2: Quel est l'impact de l'âge sur les performances des joueurs ?

## Préparation et analyse des données

Lorsqu'on regarde l'état du dataset, on constate qu'il y a une donnée manquante dans la feature "Age":
```{r echo=FALSE}
summary(data$Age)
```

On supprime donc la valeur manquante. Cette suppression n'a aucun impact sur la suite de notre analyse.
```{r echo=FALSE}
df <- data %>% 
  filter(!is.na(Age))

#On vérifie que la suppression a bien été prise en compte
summary(df$Age)
```

Les différentes positions des joueurs recensées dans le dataset sont:

```{r echo=FALSE}
unique(df$Position)
```

Pour chaque feature, on étudiera la performance de manière différente.
En effet, ça n'a pas de sens de s'intéresser au nombre de buts marqués pour un Defender par exemple.

Pour le **Goalkeeper**, on va s'intéresser à la feature *Saves*, car elle mesure sa capacité à arrêter les tirs adverses, ce qui est essentiel pour juger la performance d'un gardien

Pour le **Defender**, on va s'intéresser à la feature *Interceptions*, car elle mesure sa capacité à couper les passes adverses, ce qui permet de limiter les occasions de but et sécuriser la défense.

Pour le **Midfielder**, on va s'intéresser à la feature *Assists*, car elle reflète sa capacité à créer des occasions décisives dans le match

Pour le **Forward**, on va s'intéresser à la feature *Goals*, car c'est l'indicateur principal de son efficacité offensive, marquer des buts étant sa contribution principale attendue pour faire gagner son équipe.

```{r echo=FALSE}

df <- df %>%
  mutate(
    # Calcul de la Performance
    Performance = case_when(
      Position == "Goalkeeper" & !is.na(Saves) ~ Saves,
      Position == "Defender" & !is.na(Interceptions) ~ Interceptions,
      Position == "Midfielder" & !is.na(Assists) ~ Assists,
      Position == "Forward" & !is.na(Goals) ~ Goals,
      TRUE ~ NA_real_ #met une valeur manquante si les conditions ne sont pas remplies
    ),
    
    # Définition de la classe de la performance (feature associée)
    Performance.class = case_when(
      Position == "Goalkeeper" & !is.na(Saves) ~ "Saves",
      Position == "Defender" & !is.na(Interceptions) ~ "Interceptions",
      Position == "Midfielder" & !is.na(Assists) ~ "Assists",
      Position == "Forward" & !is.na(Goals) ~ "Goals",
      TRUE ~ NA_character_ #met une valeur manquante si les conditions ne sont pas remplies
    )
  )

 
```

```{r echo=FALSE}
unique(df$Performance.class)
```

## Visualisation

```{r echo=FALSE}
ggplot(df, aes(x = Age, y = Performance, color = Performance.class)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "loess", color = "red") +
  facet_wrap(~Position, scales = "free_y") +
  labs(title = "Performance des joueurs de Premiere League en fonction de l'âge et par position",
       x = "Âge",
       y = "Performance",
       color = "Action") +
  
  #Esthétique
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 10),
    strip.text = element_text(face = "bold", size = 9),
    axis.text = element_text(size = 9),
    legend.position = "bottom"
    )

```

## Analyse

Dans le cas des **défendants**, on constate que les performances augmentent notamment après 27 ans.
On peut cependant remarquer une forte dispersion à partir de 33 ans.

Dans le cas des **attaquants**, la progression du nombre de buts marqués augmente également avec l'âge.
Cependant, cette augmentation est plus lente et progressive que celle des défendants.

Dans le cas des **gardiens**, la progression monte jusqu'aux environs de 33 - 34 ans, puis baisse.
On peut donc estimer que le gardien aurait la meilleure performance à 33 - 34 ans.
Néanmoins, les performances sont très dispersées d'un gardien à un autre.

Dans le cas des **joueurs du milieu**, la performance est assez faible et stagnante jusqu'aux environs de 30 ans, puis il y a une augmentation assez remarquable.

En général, les performances augmentent généralement avec l’âge, mais de manière plus rapide chez les défenseurs que dans les autres positions.
Par contre, les gardiens ont une carrière relativement plus longue, avec un pic de performance plus tardif.
Enfin, pour toutes les positions, on remarque une dispersion assez importante : il y a de jeunes joueurs très performants et de plus âgés peu performants dans chaque poste.

# Question 3:Quelles sont les différences de moyenne de buts marqués selon la position ?

```{r echo=FALSE}
df_clean <- df %>%
  filter(!is.na(Position), !is.na(Goals)) %>%
  mutate(Position = case_when(
    grepl("Goalkeeper", Position, ignore.case = TRUE) ~ "Goalkeeper",
    grepl("Defender", Position, ignore.case = TRUE) ~ "Defender",
    grepl("Midfielder", Position, ignore.case = TRUE) ~ "Midfielder",
    grepl("Forward", Position, ignore.case = TRUE) ~ "Forward",
    TRUE ~ "Other"
  )) %>%
  filter(Position %in% c("Goalkeeper", "Defender", "Midfielder", "Forward"))  

position_stats <- df_clean %>%
  group_by(Position) %>%
  summarise(
    mean_goals = mean(Goals, na.rm = TRUE),
    sd_goals = sd(Goals, na.rm = TRUE),
    count = n()
  )

print(position_stats)
```

```{r pressure, echo=FALSE}
ggplot(position_stats, aes(x = Position, y = mean_goals)) +
  geom_col(fill = "skyblue", color = "black") +
  #geom_errorbar(aes(ymin = mean_goals - sd_goals, ymax = mean_goals + sd_goals),
                #width = 0.2, color = "red", linewidth = 1) +
  labs(
    title = "Nombre moyen de buts marqués par les joueurs à différents postes",
    x = "position",
    y = "Moyenne des buts"
  ) +
  theme_minimal()

ggplot(df_clean, aes(x = Position, y = Goals)) +
  geom_boxplot(fill = "lightblue", color = "black", outlier.color = "red", outlier.shape = 16) +
  labs(
    title = "Répartition des buts marqués par des joueurs occupant différents postes (graphique en boîte)",
    x = "position",
    y = "nombre de buts marqués"
  ) +
  theme_minimal()

```

## Ceci peut être analysé à l'aide du diagramme à barres et du diagramme en boîte :

1.Dans l'ensemble, les attaquants et les milieux de terrain sont chargés de marquer des buts, tandis que les défenseurs et les gardiens de but sont chargés de défendre.

2.Les attaquants sont ceux qui marquent le plus de buts dans l'ensemble, mais leurs performances sont très variables, quelques rares grands buteurs tirant la moyenne générale vers le haut.

3.Les milieux de terrain ont une capacité moyenne à marquer des buts, mais certains d'entre eux sont très impressionnants sur le plan offensif.
Cela montre qu'il ne faut pas négliger la capacité des milieux de terrain à marquer des buts, et que certains d'entre eux ont une forte capacité à s'impliquer.

4.Les défenseurs ont marqué très peu de buts et la différence globale est faible, mais certains défenseurs ont tout de même marqué un peu plus sur coups de pied arrêtés.

5.Les gardiens de but ne marquent pratiquement pas de buts et sont extrêmement réguliers.

# Question 4: Quels sont les joueurs les plus efficaces pour marquer des buts ?

La question de savoir quels joueurs sont les plus efficaces pour marquer des buts est importante dans le football.
Elle n'est pas aussi facile à répondre qu'il n'y parait.
Ce qui définit un joueur bon en attaque, n'est pas forcément sa statique du nombre de but marqués
même si elle est importante.

Pour commencer l'analyse, on va tous d'abord regarder au niveau global, c'est-à-dire dans l'ensemble de la Premier League, quels sont les joueurs qui ont marqué le plus de buts.


On constate qu'il ya des joueurs qui ont joués peu de match ce qui peut rendre les statistiques moins fiables donc on va se limiter aux joueurs ayant plus de 15 apparitions.

```{r echo=FALSE}
seuil_apparitions <- 15 

data_clean <- data %>%
  filter(!is.na(Goals), !is.na(Appearances), Appearances > seuil_apparitions, !is.na(Shooting.accuracy..)) %>%
  mutate(Goals_per_match = Goals / Appearances)  
```

## Les joueurs qui marquent le plus de but sur l'ensemble de la Premier League

L'objectif de se poser cette question, c'est d'avoir une idée de la performance des joueurs en termes de buts marqués.
On va donc se concentrer sur les joueurs qui ont marqué le plus de buts.

```{r echo=FALSE}
# Sélectionner les 10 meilleurs buteurs
top_scorers <- data_clean %>%
  arrange(desc(Goals)) %>%
  slice(1:10)

top_scorer_plot <- ggplot(top_scorers, aes(x = reorder(Name, Goals), y = Goals)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +  # Met les barres horizontales
  labs(title = "Top 10 des buteurs - Premier League",
       x = "Joueur",
       y = "Nombre de buts")

top_scorer_plot
```

On constate que les meilleurs buteurs marquent au moins plus de 50 buts dans leurs carrière et peuvent marquer plus de 100 buts.

## Vérifier la distribution de nombre de buts par match

Cependant, connaître le nombre de but marqué au total par joueurs ne suffit pas.
Parce que certains joueurs ont joué plus de matchs que d'autres et donc le nombre de but marqué.
C'est pourquoi, on va se concentrer sur le nombre de buts marqué par match.

Le jeu de données possèdent des valeurs aberrantes dans la variable goals per match , que nous avons dû corrigé en la recalculant nous même.

```{r echo=FALSE}
goals_distribution_corrected <- ggplot(data_clean, aes(x = Goals_per_match)) +
  geom_histogram(binwidth = 0.05, fill = "steelblue", color = "black", boundary = 0) +
  labs(title = "Distribution des nombres de buts par match",
       x = "Buts par match",
       y = "Nombre de joueurs") 
goals_distribution_corrected
```

L'idée est de se faire une idée de la distribution des buts par match et de savoir sur tous les joueurs y compris ceux qui n'ont pas marqué de but, combien de joueurs ont marqué.
On peut constaté qu'une minorité de joueurs ont marqué plus de 0.5 buts par match.

## Top 10 des joueurs ayant une moyenne de buts les plus élevées

On va maintenant se concentrer sur les joueurs qui ont marqué le plus de buts par match

```{r echo=FALSE}
top_10_players <- data_clean %>%
  arrange(desc(Goals_per_match)) %>% 
  head(10) %>%
  select(Name, Goals, Goals_per_match)

bar_chart <- ggplot(top_10_players, aes(x = reorder(Name, Goals_per_match), y = Goals_per_match)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Top 10 des joueurs avec la meilleur moyenne de buts par match",
       x = "Joueur",
       y = "Buts par match") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

bar_chart
```

On constate que les meilleurs joueurs en termes de buts par match font au moins 0.4 buts par match.

## L'impact de la précision du tir sur les buts par matchs

Maintenant, on va se poser la question de savoir si au football et notamment dans la Premier League, la précision du tir a un impact sur le nombre de buts marqués par match.

```{r echo=FALSE}

data_clean$`Shooting.accuracy..` <- as.numeric(gsub("%", "", data_clean$`Shooting.accuracy..`)) / 100

ggplot(data_clean, aes(x = Shooting.accuracy.., y = Goals_per_match)) +
  geom_point(color = "blue", size = 3, alpha = 0.7) + 
  geom_smooth(method = "lm", se = FALSE, color = "red", linetype = "dashed") +
  labs(title = "Précision des tirs vs moyenne de buts par match", x = "Précision des tirs (%)", y = "Buts par match") 
```

On constate qu'il y a une corrélation positive entre la précision des tirs et le nombre de buts marqués par match.
La précision des tirs est donc un facteur important pour marquer des buts.

## Comparaison du top 3 par rapports à la moyenne des joueurs de la Premier league

On va maintenant se concentrer sur les 3 meilleurs joueurs et la moyenne des joueurs de la Premier League.
L'objectif est de voir sur les 3 meilleurs joueurs qu'on peut considérer les plus efficaces devant les buts.
Il y'a-t-il un joueur qui se démarque des autres ou il y a-t-il une variable qui fait que certains joueurs marquent plus de buts que d'autres.

```{r echo=FALSE}
library(dplyr)
library(fmsb)

# Sélectionner les 3 meilleurs joueurs
top3_scorers <- data_clean %>%
  arrange(desc(Goals)) %>%
  slice(1:3) %>%
  select(Name, Goals, Shots, Shooting.accuracy.., Assists,Duels.won,Passes)

# Calculer la moyenne
mean_players <- data_clean %>%
  summarise(Goals = mean(Goals, na.rm = TRUE),
            Shots = mean(Shots, na.rm = TRUE),
            Shooting.accuracy.. = mean(Shooting.accuracy.., na.rm = TRUE),
            Assists = mean(Assists, na.rm = TRUE,),
            Duels.won = mean(Duels.won, na.rm = TRUE),
            Passes = mean(Passes, na.rm = TRUE))

# Ajouter le nom "Moyenne" à la ligne de la moyenne
mean_players$Name <- "Moyenne"

combined <- bind_rows(top3_scorers, mean_players)

rownames(combined) <- combined$Name
combined <- combined %>% select(-Name)

# Normaliser toutes les données en utilisant les min et max des données complètes (data_clean)
normalize <- function(x, min_value, max_value) {
  (x - min_value) / (max_value - min_value)
}

combined_normalized <- as.data.frame(lapply(names(combined), function(col_name) {
  normalize(combined[[col_name]], min(data_clean[[col_name]], na.rm = TRUE), max(data_clean[[col_name]], na.rm = TRUE))
}))

colnames(combined_normalized) <- c("Buts", "Tir effectué", "Précision de tirs", "Assists","Duels gagnés","Passes")

final_data <- rbind(rep(1, ncol(combined_normalized)),   # Ligne max
                    rep(0, ncol(combined_normalized)),   # Ligne min
                    combined_normalized)                # Données des joueurs et de la moyenne

colors_border <- c("red", "blue", "green", "orange", "purple", "black")
colors_in <- adjustcolor(colors_border, alpha.f = 0.2)

radarchart(final_data,
           axistype = 1,
           pcol = colors_border,
           pfcol = colors_in,
           plwd = 2,
           plty = 1,
           cglcol = "grey", cglty = 1, axislabcol = "grey", caxislabels = seq(0,1,0.2), cglwd = 0.8,
           vlcex = 0.8,
           title = "Comparaison du top 3 buteurs de Premier League")

legend(x = "topright",
       legend = c(rownames(combined)),  # Ajouter Max et Min à la légende
       bty = "n", pch=20, col=colors_border, text.col = "black", cex=0.8, pt.cex=1.5)


```

On constate que par rapport à la moyenne des joueurs de la Premier League, les meilleurs buteurs se démarquent par leur précision de tirs et le nombre de tirs effectués.
Ce ne sont pas des joueurs qui ont beaucoup de passes ou qui gagnent beaucoup de duels.
Cependant, ils ont quand même un nombre d'assists supérieur à la moyenne des joueurs de la Premier League.
Ce qui montre qu'ils sont aussi de bon passeur permettant à leur équipe de marquer.


# Question 5 : Quels sont les joueurs les moins disciplinés et est-ce qu'ils valent le coup ?

L'objectif de cette question est de savoir si un club a un réel intérêt de garder et/ou d'envoyer des joueurs "problématiques" sur le terrain. À première vue, on peut supposer que non, étant donné que lorsque les joueurs commettent des fautes ou reçoivent des cartons, l'ensemble de l'équipe est pénalisé (penalty, expulsion du joueur,...).

Pour répondre à cette question, nous allons nous intéresser aux 10 joueurs les moins disciplinés de la Premiere League.

Tout d'abord, nous allons nous intéresser au nombre de fautes commises, ainsi que les cartons rouges et jaunes reçus.

```{r echo=FALSE}

#Filtrage du dataset
df_4 <- data %>%
  select(Name, Fouls, Yellow.cards, Red.cards) %>%
  mutate(total = Fouls + Yellow.cards + Red.cards) %>% #On combine toutes les fautes pour chaque joueur 
  arrange(desc(total)) %>%
  slice_max(order_by = total, n = 10) %>% #On limite le nombre de joueurs à 10
  pivot_longer(cols = c(Fouls, Yellow.cards, Red.cards),
               names_to = "Type",
               values_to = "Count")

#Visualisation
ggplot(df_4, aes(x = reorder(Name, Count), y = Count, fill = Type)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("Fouls" = "steelblue", 
                               "Yellow.cards" = "gold", 
                               "Red.cards" = "red")) +
  labs(title = "Fautes et cartons des 10 joueurs les plus sanctionnés en Premiere League",
       x = "Joueur",
       y = "Nombre total de fautes comises",
       fill = "Type de faute") +
  
  #Esthétique
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 10),
    strip.text = element_text(face = "bold", size = 9),
    axis.text = element_text(size = 9),
    legend.position = "bottom"
    )

```

Il faut tout de même noter que les fautes (Fouls) ont une gravité très légère, mais leurs conséquences peuvent être un coup franc ou un penalty, ce qui peut pénaliser l'équipe du joueur fautif.
Les cartons jaunes et rouges ont des gravités plus élevées, d'autant plus que deux cartons jaunes ont le même effet qu'un carton rouge, à savoir l'expulsion du joueur, et son équipe qui sera désavantagée car elle jouera 10 contre 11.
Pour répondre à notre problématique, on va s'intéresser à l'ensemble des fautes commises, sans prendre en compte la gravité de ces dernières dans nos visualisations.

Néanmoins, on peut prendre du recul sur la visualisation obtenue, en supposant que les joueurs Shane Long et James McArthur peuvent être considérés comme étant plus disciplinés que Phil Bardsley, étant donné qu'ils n'ont jamais reçus de cartons rouges.

Maintenant, pour chacun des 10 joueurs, intéressons nous également à leurs performances, à savoir aux features *Goals*, *Assists* et *Interceptions*.

Afin de pouvoir les comparer directement avec les fautes commises et les cartons reçus, nous allons réaliser un spider plot pour chacun des joueurs.

```{r echo=FALSE}
top10_joueurs <- df_4 %>% distinct(Name) %>% pull(Name)

df_radar <- data %>%
  filter(Name %in% top10_joueurs) %>%
  select(Name, Position, Fouls, Yellow.cards, Red.cards, Goals, Assists, Interceptions)

normalize <- function(x) {
  (x - min(x, na.rm=TRUE)) / (max(x, na.rm=TRUE) - min(x, na.rm=TRUE))
}

df_radar_norm <- df_radar %>%
  mutate(
    Fouls = normalize(Fouls),
    Yellow.cards = normalize(Yellow.cards),
    Red.cards = normalize(Red.cards),
    Goals = normalize(Goals),
    Assists = normalize(Assists),
    Interceptions = normalize(Interceptions)
  )

radar_data <- rbind(
  max = rep(1, 6),
  min = rep(0, 6),
  df_radar_norm %>% select(Fouls, Yellow.cards, Red.cards, Goals, Assists, Interceptions)
)

rownames(radar_data) <- c("Max", "Min", df_radar_norm$Name)

cols <- qualitative_hcl(6, palette = "Dark3")

par(mfrow = c(2, 3), mar = c(1, 1, 3, 1))

for (i in 3:(nrow(radar_data))) {
  player_name <- rownames(radar_data)[i]
  player_position <- df_radar_norm %>% filter(Name == player_name) %>% pull(Position)
  
  radarchart(
    radar_data[c(1, 2, i), ],
    pcol = cols[(i - 2) %% length(cols) + 1],
    pfcol = alpha(cols[(i - 2) %% length(cols) + 1], 0.3),
    plwd = 2,
    cglcol = "grey",
    cglty = 1,
    axistype = 1,
    title = paste0(player_name),
    vlcex = 0.8
  )
}
```

Dans ces spider plots, chaque valeur est normalisée entre 0 et 1 pour permettre une comparaison équitable entre variables.
On a donc 0 qui représente le score le plus bas observé parmi les joueurs analysés, et le 1 représente le score le plus élevé.

En analysant ces spider plots, on peut remarquer que:

**Phil Bardsley**, qui a un très grand nombre de cartons jaunes (proche de 100%), réalise aussi un grand nombre d'interceptions (75%), ce qui est intéressant étant donné qu'il occupe la position *Defender*.
Autrement dit, même s'il ne réalise pas de *Goals* ni d'*Assists*, ces performances sont tout de même intéressantes lorsqu'on le compare avec les 10 joueurs les moins disciplinés.

**Christian Benteke** a un nombre assez elevé de cartons rouges (supérieur à 50%), mais c'est aussi celui qui réalise le plus grand nombre de buts marqués parmis les joueurs analysés.

**James Milner**, qui serait le joueur le moins discipliné et qui possède le plus grand nombre de *Fouls* parmis les dix joueurs observés, ainsi que des valeurs assez élevées (supérieures à 50%) pour *Yellow.cars* et *Red.cards*, a également le plus grand nombre d'*Assists*, et des valeurs élevées pour *Interceptions* et *Goals*.

**Mark Noble** est le joueur qui a reçu le plus de cartons jaunes et rouges, mais c'est aussi celui qui réalise le plus d'*Interceptions* parmis les 10 joueurs analysés.
Etant donné que sa position est *Midfielder*, on peut supposer qu'il réalise de bonnes performances parmis les dix joueurs analysés.

En comparant ces joueurs dans le sous-ensemble des dix joueurs auxquels on s'intéresse, on peut supposer que les joueurs les moins disciplinés ont quand même tendance à bien performer sur le terrain.
Néanmoins, cette permière hypothèse est biaisée, étant donné qu'on compare ces joueurs non-disciplinés aux autres joueurs non-disciplinés.

Réalisons une visualisation afin de les comparer à la moyenne globale des performances, c'est-à-dire en prenant en compte les performances de tous les joueurs de la Premiere League.

```{r echo=FALSE}
#Joueurs qu'on souhaite comparer à la moyenne
joueurs_cibles <- c("Phil Bardsley", "Christian Benteke", "James Milner", "Mark Noble")

df_joueurs <- data %>%
  filter(Name %in% joueurs_cibles) %>%
  select(Name, Goals, Assists, Interceptions)

# Moyenne sur tous les joueurs sauf les gardiens
df_moyenne <- data %>%
  filter(Position != "Goalkeeper") %>%
  summarise(across(c(Goals, Assists, Interceptions), mean, na.rm = TRUE)) %>%
  mutate(Name = "Moyenne") %>%
  select(Name, everything())

df_comparatif <- bind_rows(df_joueurs, df_moyenne)

df_long <- df_comparatif %>%
  pivot_longer(cols = -Name, names_to = "Variable", values_to = "Valeur")

#Visualisation
ggplot(df_long, aes(x = Variable, y = Valeur, fill = Name)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  scale_fill_brewer(palette = "Set1") +
  labs(title = "Comparaison des performances des joueurs avec la moyenne (hors gardiens)",
       x = "Statistique",
       y = "Valeur") +
  
  #Esthétique
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 10),
    strip.text = element_text(face = "bold", size = 9),
    axis.text = element_text(size = 9),
    legend.position = "bottom"
  )

```

On remarque que la tendance générale est que les performances des joueurs non-disciplinés sont bien supérieures à la moyenne.
Même si Phil Bardsley est inférieur à la moyenne dans les features *Assists* et *Goals*, il est largement supérieur dans la feature *Interceptions*.
Etant donné que Phil Bardsley occupe le poste *Defender*, ses performances sont mesurées majoritairement avec le nombre d'interceptions réalisés, donc on peut supposer que c'est tout de même un bon joueur.

En conclusion, les joueurs les moins disciplinés, autrement dit ceux qui commettent le plus de fautes et reçoivent le plus de cartons jaunes et/ou rouges, restent tout de même des joueurs avec des performances bien supérieures à la moyenne et peuvent donc être intéressants à avoir sur le terrain.
On peut supposer que ce paradoxe s'explique par le fait qu'ils ont tendance à prendre davantage de risques, même si ces derniers peuvent leur valoir des cartons.
Néanmoins, en prenant ces risques, ils augmentent leurs chances de faire des passes décisives, intercepter les ballons ou encore marquer des buts.

# Question 6 : Quels postes sont les plus exposés aux sanctions en Premier League ?

Pour répondre à cette question, nous avons calculé les moyennes des fautes, des cartons jaunes et rouges par poste (Forward, Midfielder, Defender, Goalkeeper), sur l’ensemble des joueurs de Premier League. L’objectif est de comparer le comportement disciplinaire moyen selon le rôle sur le terrain.
Nous avons utilisé un graphique en coordonnées parallèles pour visualiser ces différences : chaque ligne correspond à un poste, et les axes représentent les trois types de sanctions, normalisés pour permettre une comparaison équitable.

```{r echo=FALSE}
df_parallel <- data %>%
  group_by(Position) %>%
  summarise(
    Fouls = mean(Fouls, na.rm = TRUE),
    Yellow.cards = mean(Yellow.cards, na.rm = TRUE),
    Red.cards = mean(Red.cards, na.rm = TRUE)
  )

ggparcoord(
  df_parallel,
  columns = 2:4, 
  groupColumn = "Position", 
  scale = "globalminmax", 
  alphaLines = 0.7, 
  showPoints = TRUE 
) +
  scale_color_viridis_d(name = "Poste") + 
  labs(
    title = "Comparaison des sanctions moyennes par poste",
    x = "Type de sanction",
    y = "Moyenne normalisée"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right"
  )
```

### Résultats observés
L’analyse montre des différences intéressantes entre les postes :

**Fautes (Fouls)** : Ce sont les attaquants (Forwards) qui commettent en moyenne le plus de fautes. Cela peut surprendre, mais s’explique par leur pression constante sur les défenseurs et gardiens adverses. Ils sont suivis par les milieux de terrain, puis les défenseurs, tandis que les gardiens (Goalkeepers) commettent très peu de fautes.

**Cartons jaunes (Yellow cards)** : Ce sont cette fois les milieux de terrain (Midfielders) qui reçoivent le plus de cartons jaunes, ce qui s’explique par leur implication dans les phases défensives et offensives, souvent dans des zones à fort engagement physique. Ils sont suivis par les défenseurs, puis les attaquants, et enfin les gardiens, très peu sanctionnés.

**Cartons rouges (Red cards)** : La tendance est assez similaire à celle des cartons jaunes, avec les milieux et les défenseurs légèrement au-dessus, suivis des attaquants. Les gardiens reçoivent très peu de cartons rouges, ce qui confirme leur faible exposition aux fautes graves.

### Conclusion : Ce que révèle la discipline par poste
À première vue, on pourrait s’attendre à ce que les défenseurs (Defenders) soient les plus fautifs, ce qui est logique vu leur rôle défensif, mais ce n’est finalement pas le cas, ce qui est surprenant.

**Forwards (attaquants)** : Commettent le plus de fautes, souvent liées au pressing, mais reçoivent peu de cartons, ce qui indique des fautes peu graves.

**Midfielders (milieux)** : Ce sont les joueurs les plus sanctionnés globalement (fautes, jaunes, rouges). Leur rôle de pivot sur le terrain les expose à de nombreux duels et fautes tactiques.

**Defenders (défenseurs)** : Bien que très sollicités défensivement, ils ne sont pas systématiquement les plus sanctionnés, ce qui peut indiquer une plus grande maîtrise dans l’engagement physique.

**Goalkeepers (gardiens)** : Ce sont les joueurs les plus disciplinés. Leur position spécifique, peu sujette aux duels, les met rarement en situation de faute. 
